page.title=New multimedia application
doc.type=tutorials
@jd:body
<div class="background-sdk">
	<div class="content-block">
		<div class="intro center" >
			<p><h1>New multimedia application</h1></p>
			<p><span>This tutorial demonstrates how to build a new multimedia application based on the joyn technology.</span></p>
			<p><span>The multimedia application implements a conversational mobile-to-mobile service which permits to exchange data in real time. A multimedia session is established between the two endpoints by using the joyn platform, then the media is exchanged via any protocol (TCP, RTP, HTTP, .etc). Itâ€™s up to the application to implement the media layer, the joyn API just offers the way to initiate and to manage the multimedia session (i.e. signaling flow).</span></p>
			<p><span>This tutorial shows how to exchange text in real time over the TCP protocol.</span></p>
			<p><span>This application uses the following API :</span></p>
			<ul>
				<li>
					<p><span>The <a href="{@docRoot}javadoc/org/gsma/joyn/session/package-summary.html">Multimedia Session</a> API to initiate and to manage multimedia sessions (accept, reject, terminate).</span></p>
				</li>
				<li>
					<p><span>An SDP API which permits to parse and to build the SDP data exchanged during the multimedia session initialisation. An SDP lib is also provided with this tutorial. The SDP protocol is used to negociate the media session between the two end points (protocol, codecs, format, .etc) and the SDP content depends of the type of media to exchange.</span></p>				
				</li>
			</ul>
			<p><span>The Multimedia Session API supports the following call flow :</span></p>
			<p><span><b>Originating side :</b></span></p>
			<p></p>
			<div style="width:700px;margin:auto;">
				<img src="{@docRoot}assets-sdk/images/multi_sample_1.png" width="100%"/>
			</div>
			<p></p>
			<p><span><b>Terminating side :</b></span></p>
			<p></p>
			<div style="width:700px;margin:auto;">
				<img src="{@docRoot}assets-sdk/images/multi_sample_2.png" width="100%"/>
			</div>
			<p></p>
			<p><span>The Multimedia Session API hides the complexity of the SIP protocol (the signalling technology for joyn services) and permits to open the API for new the implementation of new services. This API may also be combined with Capability API to discover the new service accross contacts and to offer a complete end-to-end solution.</span></p>
			<p><span>For more details, see also the following references :</span></p>
			<ul>
				<li>
					<p><span>SIP (Session Initiation Protocol) : <a href="http://www.ietf.org/rfc/rfc3261.txt">RFC3261</a>.</span></p>
				</li>
				<li>
					<p><span>SDP (Session Description Protocol) : <a href="http://www.ietf.org/rfc/rfc4566.txt">RFC3261</a>.</span></p>				
				</li>
				<li>
					<p><span>SDP Answer/Offer model : <a href="http://www.ietf.org/rfc/rfc3264.txt">RFC3264</a>.</span></p>				
				</li>
			</ul>
			<p></p>
			</br>
			<h1>How to implement a new multimedia service?</h1>
		</div>
		<div class="content-body center" style="min-height:700px;">
			<div class="guide-block">
				<h2>1. Defines a service ID associated to your new application or service</h2>
				<p></p>
				<p>A unique service ID should be associated to your application, this ID is used to route the incoming request internally in the API and may be used by the joyn platform for billing and routing.</p>
				<p>The service ID corresponds also to a capability (or extension) associated to your application (see <a href="{@docRoot}javadoc/org/gsma/joyn/capability/package-summary.html">Capability</a> API).</p>						
				<p>Here the chosen service ID is :</p>
				<p><b>+g.3gpp.iari-ref="urn%3aurn-7%3a3gpp-application.ims.iari.rcse.<span style="color:red">orange.texto</span>"</b></p>
				<p></p>
			</div>
			</br>
			<div class="guide-block">
				<h2>2. Defines a protocol to exchange the media </h2>
				<p></p>				
				<p><b>SDP offer :</b></p>
				<div class="code-block">
					<tt class="java">
						<span class="java10">
							&#xA0;v=0</br>
							&#xA0;o=- 3587892425 3587892425 IN IP4 <span style="color:green">10.29.67.27</span></br>
							&#xA0;s=DEMO</br>
							&#xA0;c=IN <span style="color:green">IP4 10.29.67.27</span></br>
							&#xA0;t=0 0</br>
							&#xA0;m=<span style="color:red">text</span> <span style="color:green">5000</span> <span style="color:red">TCP</span> 96</br>
							&#xA0;a=setup:<span style="color:red">active</span></br>
							&#xA0;a=sendrecv</br>
						</span>
					</tt>
				</div>
				<p></p>
				<p>In the SDP offer, the originating end point indicates that a TCP connection will be initiated to transfer text and the end point will initiate the connection to the remote end point (TCP client mode).</p>
				<p><b>SDP answer :</b></p>
				<div class="code-block">
					<tt class="java">
						<span class="java10">
							&#xA0;v=0</br>
							&#xA0;o=- 3587892425 3587892425 IN IP4 <span style="color:green">10.29.67.40</span></br>
							&#xA0;s=DEMO</br>
							&#xA0;c=IN IP4 <span style="color:green">10.29.67.40</span></br>
							&#xA0;t=0 0</br>
							&#xA0;m=<span style="color:red">text</span> <span style="color:green">5000</span> <span style="color:red">TCP</span> 96</br>
							&#xA0;a=setup:<span style="color:red">passive</span></br>
							&#xA0;a=sendrecv</br>
						</span>
					</tt>
				</div>
				<p></p>
				<p>In the SDP offer, the terminating end point indicates that a TCP connection will be initiated to transfer text and the end point will wait a connection from the remote end point (TCP server mode).</p>
				<p></p>
			</div>
			</br>
			<div class="guide-block">
				<h2>3. Implements the sender side (see class InitiateMultimediaSession</h2>
				<p></p>
				<p>The session is initiated to a remote contact with the service ID and a local SDP offer.</p>
				<p></p>
				<div class="code-block">
					<tt class="java"><span class="java3">// MM session<br />
						</span><span class="java4">private </span><span class="java10">MultimediaSession session = </span><span class="java4">null</span><span class="java10">;<br />
						<br />
						</span><span class="java3">// MM session listener<br />
						</span><span class="java4">private </span><span class="java10">MySessionListener sessionListener = </span><span class="java4">new </span><span class="java10">MySessionListener</span><span class="java8">()</span><span class="java10">;<br />
						<br />
						...<br />
						</span><span class="java3">// Initiate session<br />
						</span><span class="java10">session = sessionApi.initiateSession</span><span class="java8">(</span><span class="java10">serviceId, contact, localSdp, sessionListener</span><span class="java8">)</span><span class="java10">;<br />
						...<br />
						<br />
						</span><span class="java3">// Session event listener<br />
						</span><span class="java4">private class </span><span class="java10">MySessionListener </span><span class="java4">extends </span><span class="java10">MultimediaSessionListener </span><span class="java8">{<br />
						&#xA0; </span><span class="java3">// Session ringing<br />
						&#xA0; </span><span class="java4">public </span><span class="java9">void </span><span class="java10">onSessionRinging</span><span class="java8">() {<br />
						&#xA0; </span><span class="java10">...<br />
						&#xA0; </span><span class="java8">}<br />
						<br />
						&#xA0; </span><span class="java3">// Session started<br />
						&#xA0; </span><span class="java4">public </span><span class="java9">void </span><span class="java10">onSessionStarted</span><span class="java8">() {<br />
						&#xA0;&#xA0;&#xA0; </span><span class="java10">&lt; TCP client connection &gt;<br />
						&#xA0; </span><span class="java8">}<br />
						<br />
						&#xA0; </span><span class="java3">// Session aborted<br />
						&#xA0; </span><span class="java4">public </span><span class="java9">void </span><span class="java10">onSessionAborted</span><span class="java8">() {<br />
						&#xA0; </span><span class="java10">...<br />
						&#xA0; </span><span class="java8">}<br />
						<br />
						&#xA0; </span><span class="java3">// Session error<br />
						&#xA0; </span><span class="java4">public </span><span class="java9">void </span><span class="java10">onSessionError</span><span class="java8">(</span><span class="java4">final </span><span class="java9">int </span><span class="java10">error</span><span class="java8">) {<br />
						&#xA0; </span><span class="java10">...<br />
						&#xA0; </span><span class="java8">}<br />
						}</span><span class="java10">;</span>
					</tt>
				</div>
				<p></p>
				<p><span style="color:red">Important note :</span> here, because it is NOT defined in the Manisfest file, the service ID (or extension) should have the following syntax :</p>
				<p><b>+g.3gpp.iari-ref<span style="color:red">="</span>urn%3Aurn-7%3A3gpp-application.ims.iari.rcse.XXXX<span style="color:red">"</span></b>,</br>where XXXX is your service ID.</p>
				<p></p>
			</div>
			</br>
			<div class="guide-block">
				<h2>4. Implements the receiver side (see class MultimediaSessionInvitationReceiver)</h2>
				<p></p>
				<div class="code-block">
					<tt class="java"><span class="java10">&lt;receiver android:name=</span><span class="java5">&#34;.session.MultimediaSessionInvitationReceiver&#34;</span><span class="java10">&gt;<br />
						&#xA0; &lt;intent-filter&gt;<br />
						&#xA0; action android:name=</span><span class="java5">&#34;org.gsma.joyn.session.action.NEW_SESSION&#34;</span><span class="java10">/&gt;<br />
						&#xA0; &lt;data android:mimeType=</span><span class="java5">&#34;+g.3gpp.iari-ref/urn%3aurn-7%3a3gpp-application.ims.iari.rcse.orange.texto&#34; </span><span class="java10">/&gt;<br />
						&#xA0; &lt;category android:name=</span><span class="java5">&#34;android.intent.category.LAUNCHER&#34; </span><span class="java10">/&gt;<br />
						&#xA0; &lt;category android:name=</span><span class="java5">&#34;android.intent.category.DEFAULT&#34; </span><span class="java10">/&gt;<br />
						&#xA0; &lt;/intent-filter&gt;<br />
						&lt;/receiver&gt;</span>
					</tt>
				</div>
				<p></p>
				<p>Then the Intent receiver gets the session instance from its session ID found in the incoming Intent :</p>
				<p></p>
				<div class="code-block">
					<tt class="java"><span class="java3">// MM session<br />
						</span><span class="java4">private </span><span class="java10">MultimediaSession session = </span><span class="java4">null</span><span class="java10">;<br />
						<br />
						</span><span class="java3">// MM session listener<br />
						</span><span class="java4">private </span><span class="java10">MySessionListener sessionListener = </span><span class="java4">new </span><span class="java10">MySessionListener</span><span class="java8">()</span><span class="java10">;<br />
						<br />
						...<br />
						<br />
						</span><span class="java3">// Get session ID<br />
						</span><span class="java10">String sessionId = invitation.getStringExtra</span><span class="java8">(</span><span class="java10">MultimediaSessionIntent.EXTRA_SESSION_ID</span><span class="java8">)</span><span class="java10">;<br />
						<br />
						</span><span class="java3">// Get the session<br />
						</span><span class="java10">session = sessionApi.getSession</span><span class="java8">(</span><span class="java10">sessionId</span><span class="java8">)</span><span class="java10">;<br />
						<br />
						</span><span class="java3">// Add session event listener<br />
						</span><span class="java10">session.addEventListener</span><span class="java8">(</span><span class="java10">sessionListener</span><span class="java8">)</span><span class="java10">;<br />
						<br />
						&lt; TCP server init &gt;<br />
						<br />
						...<br />
						</span><span class="java3">// Accept the invitation<br />
						</span><span class="java10">session.acceptInvitation</span><span class="java8">(</span><span class="java10">localSdp</span><span class="java8">)</span><span class="java10">;<br />
						<br />
						</span><span class="java3">// Session event listener<br />
						</span><span class="java4">private class </span><span class="java10">MySessionListener </span><span class="java4">extends </span><span class="java10">MultimediaSessionListener </span><span class="java8">{<br />
						&#xA0; </span><span class="java3">// Session ringing<br />
						&#xA0; </span><span class="java4">public </span><span class="java9">void </span><span class="java10">onSessionRinging</span><span class="java8">() {<br />
						&#xA0; </span><span class="java10">...<br />
						&#xA0; </span><span class="java8">}<br />
						<br />
						&#xA0; </span><span class="java3">// Session started<br />
						&#xA0; </span><span class="java4">public </span><span class="java9">void </span><span class="java10">onSessionStarted</span><span class="java8">() {<br />
						&#xA0; </span><span class="java10">...<br />
						&#xA0; </span><span class="java8">}<br />
						<br />
						&#xA0; </span><span class="java3">// Session aborted<br />
						&#xA0; </span><span class="java4">public </span><span class="java9">void </span><span class="java10">onSessionAborted</span><span class="java8">() {<br />
						&#xA0; </span><span class="java10">...<br />
						&#xA0; </span><span class="java8">}<br />
						<br />
						&#xA0; </span><span class="java3">// Session error<br />
						&#xA0; </span><span class="java4">public </span><span class="java9">void </span><span class="java10">onSessionError</span><span class="java8">(</span><span class="java4">final </span><span class="java9">int </span><span class="java10">error</span><span class="java8">) {<br />
						&#xA0; </span><span class="java10">...<br />
						&#xA0; </span><span class="java8">}<br />
						}</span><span class="java10">;</span>
					</tt>
				</div>
				<p></p>
				<p><span style="color:red">Important note :</span> here, because it is defined in the Manisfest file, the extension should have the following syntax in lowercase :</p>
				<p><b>+g.3gpp.iari-ref<span style="color:red">/</span>urn%3<span style="color:red">a</span>urn-7%3<span style="color:red">a</span>3gpp-application.ims.iari.rcse.XXXX</b>,</br>where XXXX is your service ID.</p>
				<p></p>
				<p>See the complete source code of the application <a href="https://code.google.com/p/rcsjta/source/browse/#git%2Fsamples%2Fextension" target="_blank">here</a>.</p>
				<p></p>
			</div>
			</br>
		</div>
	</div>
</div>